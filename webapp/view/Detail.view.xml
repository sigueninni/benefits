<mvc:View
    controllerName="com.un.zhrbenefrequests.controller.Detail"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:commons="sap.suite.ui.commons"
    xmlns:c="sap.suite.ui.commons"
    xmlns:uxap="sap.uxap"
    xmlns:l="sap.ui.layout"
    xmlns:form="sap.ui.layout.form"
    xmlns:core="sap.ui.core"
    xmlns:viz="sap.viz.ui5.controls"
    xmlns:viz.feeds="sap.viz.ui5.controls.common.feeds"
    busy="{detailView>/busy}"
    busyIndicatorDelay="{detailView>/delay}"
    displayBlock="true"
>
    <uxap:ObjectPageLayout
        showTitleInHeaderContent="true"
        showHeaderContent="true"
        showAnchorBar="true"
        showFooter="true"
        subSectionLayout="TitleOnTop"
    >
        <uxap:headerTitle>
            <uxap:ObjectPageHeader
                objectTitle="{RequestDesc}"
                objectSubtitle="{RequestTypeTxt}"
                objectImageShape="Square"
                isObjectIconAlwaysVisible="false"
                isObjectTitleAlwaysVisible="false"
                isObjectSubtitleAlwaysVisible="false"
                isActionAreaAlwaysVisible="true"
            >
                <uxap:actions>
                    <!--                     <Button
                        text="{i18n>complete}"
                        type="Default"
                        visible="{RequestSettings/IsEditEnabled}"
                        press="onCompleteButtonPress"
                    />
                    <Button
                        text="{i18n>edit}"
                        type="Emphasized"
                        visible="{RequestSettings/IsEditEnabled}"
                        press="onEditButtonPress"
                    /> -->

                    <!-- ============================================================================ -->
                    <!-- CONDITIONAL ACTION BUTTONS - COMMENTED OUT (ALWAYS VISIBLE NOW)             -->
                    <!-- ============================================================================ -->
                    <!-- 
                        Button Visibility Logic - DISABLED:
                        
                        APPROVAL BUTTONS (APPROVE/REJECT/RETURN):
                        - Was: Visible when RequestStatus = SUBMITTED AND UserRole â‰  EMPLOYEE
                        - Now: Always visible
                        
                        EMPLOYEE BUTTONS (SUBMIT/DELETE): 
                        - Was: Visible when RequestStatus = DRAFT AND UserRole = EMPLOYEE
                        - Now: Always visible
                        
                        FLOATING TOOLBAR:
                        - Was: Visible when (DRAFT + EMPLOYEE) OR (SUBMITTED + HRA)
                        - Now: Always visible
                    -->

                    <Button
                        id="BTNAPPROVE"
                        text="{i18n>approve}"
                        type="Accept"
                        press="onApproveButtonPress"
                    />
                    <Button
                        id="BTNREJECT"
                        text="{i18n>reject}"
                        type="Reject"
                        press="onRejectButtonPress"
                    />
                    <Button
                        id="BTNRETURN"
                        text="{i18n>return}"
                        type="Emphasized"
                        press="onReturnButtonPress"
                    />
                    <Button
                        id="BTNSUBMIT"
                        text="{i18n>submit}"
                        type="Emphasized"
                        press="onSubmitButtonPress"
                    />
                    <Button
                        id="BTNDELETE"
                        text="{i18n>delete}"
                        type="Default"
                        press="onDeleteButtonPress"
                    />
                    <!--                     <Button
                        icon="sap-icon://expense-report"
                        tooltip="{i18n>costSimulation}"
                        type="Emphasized"
                    />
                    <Button
                        icon="sap-icon://expense-report"
                        text="{i18n>triggerRecruitment}"
                        tooltip="{i18n>triggerRecruitment}"
                        enabled="false"
                        type="Default"
                    /> -->
                </uxap:actions>
            </uxap:ObjectPageHeader>
        </uxap:headerTitle>
        <uxap:headerContent>
            <l:VerticalLayout>
                <ObjectAttribute text="{RequestKey}" />
                <ObjectStatus
                    title="{i18n>status}"
                    text="{RequestStatusTxt}"
                    state="{ path: 'RequestStatus', formatter: '.formatter.requestStatusStateText' }"
                    id="status"
                />
                <ObjectAttribute
                    title="{i18n>createdOn}"
                    text="{path: 'CreationDate', type: 'sap.ui.model.type.Date', formatOptions: { style: 'medium', strictParsing: true, relative: false, pattern: 'dd/MM/yyyy', UTC: true }}"
                />
                <!--           <ObjectAttribute
                    title="{i18n>createdBy}"
                    text="{CreatorLname}"
                /> -->
            </l:VerticalLayout>
            <!--            <l:VerticalLayout>
                <ObjectStatus
                    title="{i18n>status}"
                   text="{RequestStatusTxt}"
                             state="{ path: 'RequestStatus', formatter: '.formatter.requestStatusStateText' }"
                    id="status"
                    
                />

            
            </l:VerticalLayout> -->

            <!--         <l:VerticalLayout>
                <Label text="" />
            </l:VerticalLayout> -->

            <l:VerticalLayout>
                <Label text="{i18n>completeness}" />
                <ProgressIndicator
                    percentValue="{path: 'Completion', formatter: '.formatter.formatCompletionValue'}"
                    state="{path: 'Completion', formatter: '.formatter.getCompletionState'}"
                    displayValue="{path: 'Completion', formatter: '.formatter.formatCompletionDisplay'}"
                    showValue="true"
                    class="sapUiMediumMarginBegin"
                />
            </l:VerticalLayout>

            <!--      <ObjectStatus
                    title="{i18n>step}"
                    text="{ path: 'SubStatus', formatter: '.formatter.subStatusText'}"
                    id="subStatus"
                    visible="{ path: 'SubStatus', formatter: '.formatter.subStatusVisibility' }"
                /> -->
        </uxap:headerContent>
        <!-- Section and forms  : Rental Subsidy-->
        <uxap:sections>
            <uxap:ObjectPageSection
                id="rentalSubsidyFormSection"
                showTitle="true"
                title="{i18n>rentalSubsidyRequestForm}"
                titleUppercase="true"
                visible="{= ${RequestType} === '02' }"
            >
                <uxap:subSections>
                    <!-- Rental Data -->
                    <uxap:ObjectPageSubSection
                        id="RENTALDATASUBSECTION"
                        title="{i18n>RentalData}"
                    >
                        <uxap:blocks>
                            <core:Fragment
                                fragmentName="com.un.zhrbenefrequests.fragment.form.rentalSubsidy.RentalData"
                                type="XML"
                                xmlns:core="sap.ui.core"
                            />
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>

                    <!-- Others Data -->
                    <uxap:ObjectPageSubSection
                        id="RENTALOTHERSSUBSECTION"
                        title="{i18n>additionalFields}"
                    >
                        <uxap:blocks>
                            <core:Fragment
                                fragmentName="com.un.zhrbenefrequests.fragment.form.rentalSubsidy.AdditionalFields"
                                type="XML"
                                xmlns:core="sap.ui.core"
                            />
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>

            <!-- Section and forms  : Education Grant-->
            <uxap:ObjectPageSection
                id="educationGrantFormSection"
                showTitle="true"
                title="{i18n>educationGrantRequestForm}"
                titleUppercase="true"
                visible="{= ${RequestType} === '01' }"
            >
                <uxap:subSections>
                    <!-- Child Information -->
                    <uxap:ObjectPageSubSection
                        id="CHILDINFORMATIONSUBSECTION"
                        title="{i18n>childInformation}"
                    >
                        <uxap:blocks>
                            <core:Fragment
                                fragmentName="com.un.zhrbenefrequests.fragment.form.educationGrant.ChildInformation"
                                type="XML"
                                xmlns:core="sap.ui.core"
                            />
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>

                    <!-- SchoolInformation -->
                    <uxap:ObjectPageSubSection
                        id="SCHOOLINFORMATIONSUBSECTION"
                        title="{i18n>SchoolInformationData}"
                    >
                        <uxap:blocks>
                            <core:Fragment
                                fragmentName="com.un.zhrbenefrequests.fragment.form.educationGrant.SchoolInformation"
                                type="XML"
                                xmlns:core="sap.ui.core"
                            />
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>

                    <!-- Eligibility -->
                    <uxap:ObjectPageSubSection
                        id="ELIGIBILITYSUBSECTION"
                        title="{i18n>eligibilityData}"
                    >
                        <uxap:blocks>
                            <core:Fragment
                                fragmentName="com.un.zhrbenefrequests.fragment.form.educationGrant.Eligibility"
                                type="XML"
                                xmlns:core="sap.ui.core"
                            />
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>

                    <!-- Others -->
                    <uxap:ObjectPageSubSection
                        id="OTHERSSUBSECTION"
                        title="{i18n>othersData}"
                    >
                        <uxap:blocks>
                            <core:Fragment
                                fragmentName="com.un.zhrbenefrequests.fragment.form.educationGrant.Others"
                                type="XML"
                                xmlns:core="sap.ui.core"
                            />
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>

            <!-- Claims Section -->
            <uxap:ObjectPageSection
                id="claimsSection"
                title="{i18n>Claims}"
                visible="{= ${Isclaim} &amp;&amp; ${RequestType} === '01' }"
            >
                <uxap:subSections>
                    <uxap:ObjectPageSubSection id="CLAIMSSUBSECTION">
                        <uxap:blocks>
                            <core:Fragment
                                fragmentName="com.un.zhrbenefrequests.fragment.form.educationGrant.Claim"
                                type="XML"
                                xmlns:core="sap.ui.core"
                            />
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>

            <!-- Advances Section -->
            <uxap:ObjectPageSection
                id="advancesSection"
                title="{i18n>Advances}"
                visible="{= ${Isadvance} &amp;&amp; ${RequestType} === '01' }"
            >
                <uxap:subSections>
                    <uxap:ObjectPageSubSection id="ADVANCESSUBSECTION">
                        <uxap:blocks>
                            <core:Fragment
                                fragmentName="com.un.zhrbenefrequests.fragment.form.educationGrant.Advance"
                                type="XML"
                                xmlns:core="sap.ui.core"
                            />
                        </uxap:blocks>
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>

            <!-- Comment Section -->
            <!--     <uxap:ObjectPageSection
                id="commentsSection"
                title="Comments"
            >
                <uxap:subSections>
                    <uxap:ObjectPageSubSection id="commentSubSection">
                        <VBox>
                            <FeedInput
                                post="onFeedInputPosted"
                                showIcon="false"
                                visible="{RequestSettings/IsCommentsEnabled}"
                            />
                         
                            <List
                                showSeparators="Inner"
                                mode="Delete"
                                delete="onDeleteFeedItemBtnPressed"
                            >
                                <FeedListItem
                                    sender="{CreatorName}"
                                    showIcon="false"
                                    senderActive="false"
                                    timestamp="{ path: 'CreatedOn', type: 'sap.ui.model.type.Date', formatOptions: { pattern: 'dd MMM yyyy', UTC: true } } { path: 'CreatedAt', formatter: '.formatter.formatTime'}"
                                    text="{Note}"
                                />
                            </List>
                        </VBox>
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection> -->

            <!-- Attachment Section - Education Grant -->
            <uxap:ObjectPageSection
                id="educGrantAttachmentsSection"
                title="Education Grant Attachments"
                visible="{= ${RequestType} === '01' }"
            >
                <uxap:subSections>
                    <uxap:ObjectPageSubSection
                        id="EDUCGRANTATTACHMENTSSUBSECTION"
                    >
                        <core:Fragment
                            fragmentName="com.un.zhrbenefrequests.fragment.form.educationGrant.Attachments"
                            type="XML"
                            xmlns:core="sap.ui.core"
                        />
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>

            <!-- Attachment Section - Rental Subsidy -->
            <uxap:ObjectPageSection
                id="rentalSubsidyAttachmentsSection"
                title="Rental Subsidy Attachments"
                visible="{= ${RequestType} === '02' }"
            >
                <uxap:subSections>
                    <uxap:ObjectPageSubSection
                        id="RENTALSUBSIDYATTACHMENTSSUBSECTION"
                    >
                        <core:Fragment
                            fragmentName="com.un.zhrbenefrequests.fragment.form.rentalSubsidy.Attachments"
                            type="XML"
                            xmlns:core="sap.ui.core"
                        />
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection>

            <!-- TimeLine Section -->
           <uxap:ObjectPageSection
                id="timeLineSection"
                title="TimeLine"
            >
                <uxap:subSections>
                    <uxap:ObjectPageSubSection id="TIMELINESUBSECTION">
                        <core:Fragment
                            fragmentName="com.un.zhrbenefrequests.fragment.form.educationGrant.TimeLine"
                            type="XML"
                            xmlns:core="sap.ui.core"
                        /> 
                    </uxap:ObjectPageSubSection>
                </uxap:subSections>
            </uxap:ObjectPageSection> 
            <!-- TimeLine Section -->
 <!-- <uxap:ObjectPageSection
                id="timeLineSection2"
                title="TimeLine"
            >
                <uxap:subSections>
                    <uxap:ObjectPageSubSection id="TIMELINESUBSECTION2">
                        <c:Timeline
                            id="idTimeline2"
                            enableDoubleSided="true"
                            groupBy="HireDate"
                            growingThreshold="0"
                            filterTitle="Job Title"
                            sortOldestFirst="true"
                            content="{commentsModel>/Employees}"
                            enableScroll="false"
                        >
                            <c:content>
                                <c:TimelineItem
                                    id="idTemplateItem2"
                                    dateTime="{commentsModel>HireDate}"
                                    title="{commentsModel>JobTitle}"
                                    userNameClickable="true"
                                    userPicture="{commentsModel>Photo}"
                                    text="{commentsModel>Coment}"
                                    userName="{commentsModel>Name}"
                                    filterValue="{commentsModel>JobTitle}"
                                    icon="{commentsModel>Icon}"
                                />
                            </c:content>
                        </c:Timeline>
                    </uxap:ObjectPageSubSection> -->
    <!-- </uxap:subSections>
</uxap:ObjectPageSection> -->
        </uxap:sections>
        <uxap:footer>
            <!-- ================================================================= -->
            <!-- FLOATING TOOLBAR - ALWAYS VISIBLE (CONDITIONAL LOGIC COMMENTED)  -->
            <!-- ================================================================= -->
            <!-- 
                Conditional visibility DISABLED - was based on user role and request status:
                - Was: EMPLOYEE + DRAFT: Show toolbar for editing/submitting
                - Was: HRA + SUBMITTED: Show toolbar for approval actions
                - Now: Always visible
            -->
            <OverflowToolbar id="FLOATBAR" design="Transparent">
                <content>
                    <Button
                        id="BTNmessagePopover"
                        icon="sap-icon://message-popup"
                        type="Emphasized"
                        text="{=${message>/}.length}"
                        visible="{=!!${message>/}.length}"
                        press="onMessagesButtonPress"
                    />
                    <DraftIndicator
                        id="draftIndicator"
                        state="Saved"
                        minDisplayTime="1500"
                        visible="{RequestSettings/IsDraftHandlingEnabled}"
                    />
                    <ToolbarSpacer width="" />
                    <Button
                        id="BTNsave"
                        text="{i18n>save}"
                        press="onSaveBenefitRequestObject"
                        type="Emphasized"
                        visible="{RequestSettings/IsDraftHandlingEnabled}"
                    />
                    <Button
                        id="BTNcancel"
                        text="{i18n>cancel}"
                        press="onCancelButtonPress"
                        visible="{RequestSettings/IsDraftHandlingEnabled}"
                    />
                    <!--                     <Button
                        text="{i18n>saveAndClose}"
                        type="Emphasized"
                        visible="{RequestSettings/IsEditionActionsEnabled}"
                        press="onSaveEditionButtonPress"
                    />
                    <Button
                        text="{i18n>cancelAndClose}"
                        type="Default"
                        visible="{RequestSettings/IsEditionActionsEnabled}"
                        press="onCancelEditButtonPress"
                    /> -->
                </content>
            </OverflowToolbar>
        </uxap:footer>
    </uxap:ObjectPageLayout>
</mvc:View>
